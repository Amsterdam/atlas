import ReactDOM from 'react-dom'

angular.module('dpDetail').component('dpGrondexploitatieGraphPhased', {
  bindings: {
    data: '<',
  },
  templateUrl:
    'modules/detail/components/detail/templates/grondexploitatie/graph-phased/grondexploitatie-graph-phased.html', //eslint-disable-line
  controller: DpGrondexploitatieGraphPhased,
  controllerAs: 'vm',
})

DpGrondexploitatieGraphPhased.$inject = ['$timeout', '$window']

function DpGrondexploitatieGraphPhased($timeout, $window) {
  const vm = this
  const { React } = $window
  const { render } = $window
  const GraphWrapper = $window.DetailGrondexploitatieGraphPhasedWrapper
  let graphNode

  const mountReactComponents = data => {
    graphNode = document.getElementById('detail-grondexploitatie-graph-phased')
    /* istanbul ignore next */
    if (graphNode) {
      render(React.createElement(GraphWrapper, { data }), graphNode)
    }
  }

  $timeout(() => {
    mountReactComponents(vm.data)
  })

  this.$onDestroy = () => {
    if (graphNode) {
      ReactDOM.unmountComponentAtNode(graphNode)
    }
  }
}
