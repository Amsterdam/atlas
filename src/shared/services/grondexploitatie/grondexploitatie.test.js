import fetchByUri from './grondexploitatie'
import { getByUrl } from '../api/api'

jest.mock('../api/api')

describe('Grondexploitatie Grafiek Totale Begroting Service', () => {
  afterEach(() => {
    getByUrl.mockReset()
  })

  it('should return the correct response', async () => {
    const uri = 'https://acc.api.data.amsterdam.nl/grondexploitatie/123456'

    getByUrl.mockReturnValueOnce(
      Promise.resolve({
        begroting: 'Werkbegroting',
        plannaam: 'Uitvoeringsbesluit',
        startdatum: '2010-01-01',
        prijspeildatum: '2017-01-02',
      }),
    )

    const promise = fetchByUri(uri).then(response => {
      expect(response).toEqual({
        begroting: 'Werkbegroting',
        plannaam: 'Uitvoeringsbesluit',
        startdatum: new Date('2010-01-01'),
        prijspeildatum: new Date('2017-01-02'),
      })
    })

    expect(getByUrl).toHaveBeenCalledWith(uri)
    return promise
  })
})
